# AWS サービスアーキテクチャ概要

このドキュメントでは、このプロジェクトで使用している AWS サービスの全体像と連携方法について説明します。

## 使用サービスと役割

本プロジェクトでは以下の AWS サービスを LocalStack 上でエミュレートしています：

### API Gateway

**役割**: フロントエンドとバックエンドを繋ぐ API エンドポイントを提供

- RESTful API インターフェースを公開
- Lambda 関数へのリクエストのルーティング
- API リクエストの認証・認可（このサンプルでは実装なし）
- CORS サポート

### Lambda

**役割**: サーバーレスでビジネスロジックを実行

- タスク管理 API の処理（作成・取得・一覧・更新・削除）
- ファイル操作 API の処理（アップロード URL 生成・メタデータ管理など）
- SQS キューからのメッセージの処理

### DynamoDB

**役割**: NoSQL データベースとしてデータを永続化

- タスク情報の保存
- ファイルメタデータの保存
- スケーラブルなデータストレージの提供

### S3

**役割**: オブジェクトストレージとしてファイルを保存

- ユーザーがアップロードしたファイルの保存
- ファイルへのアクセス制御
- 署名付き URL によるセキュアなファイルアクセス

### SQS

**役割**: メッセージキューによる非同期処理をサポート

- タスクのイベント通知（作成・更新・削除）
- Lambda 関数間の疎結合な連携
- イベント駆動型アーキテクチャの実現

## サービス連携フロー

本アプリケーションにおける主要なサービス連携フローは以下の通りです：

### 1. タスク管理フロー

```
クライアント -> API Gateway -> Lambda -> DynamoDB
                                    |
                                    v
                                  SQS -> Lambda (イベント処理)
```

1. クライアントが API Gateway にタスク操作リクエストを送信
2. API Gateway が対応する Lambda 関数を起動
3. Lambda 関数が DynamoDB にタスクデータを保存/更新/削除
4. 同時に Lambda 関数が操作イベントを SQS に送信
5. SQS からのイベントを処理する Lambda 関数が起動し、追加処理を実行

### 2. ファイル管理フロー

```
クライアント -> API Gateway -> Lambda -> S3 (署名付き URL 生成)
                                    |
                                    v
                               DynamoDB (メタデータ保存)
```

1. クライアントが API Gateway にファイルアップロード URL のリクエストを送信
2. Lambda 関数が S3 の署名付き URL を生成
3. クライアントが URL を使って S3 に直接ファイルをアップロード
4. Lambda 関数がファイルメタデータを DynamoDB に保存

### 3. イベント処理フロー

```
各種操作 -> SQS -> Lambda (イベント処理) -> 追加ビジネスロジック
```

1. タスク作成・更新・削除時に SQS にイベントメッセージが送信される
2. SQS イベントを処理する Lambda 関数が起動
3. イベントの種類に応じた追加処理が実行される（通知、統計更新など）

## アーキテクチャの利点

- **スケーラビリティ**: サーバーレスアーキテクチャにより、需要に応じて自動的にスケール
- **疎結合**: サービス間の依存性が低く、個別の更新・拡張が容易
- **耐障害性**: キューを使った非同期処理により、一時的な障害に強い設計
- **コスト効率**: 使用した分だけ課金される従量課金制（本番環境の場合）

## LocalStack での検証

開発環境では LocalStack を使用することで、AWS アカウントなしで上記のすべてのサービスをローカルで再現できます。これにより：

- 開発コストの削減
- 開発・テストサイクルの高速化
- インフラ構成の検証が容易
- CI/CD パイプラインへの統合が簡単
